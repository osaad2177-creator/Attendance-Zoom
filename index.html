async function sendAttendance({ employeeName, attendanceType, latitude, longitude }) {
  const controller = new AbortController();
  const timeoutId = window.setTimeout(() => controller.abort(), 12000);

  try {
    const mapsLink = `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`;

    const url = new URL(APPS_SCRIPT_URL);
    url.searchParams.set("employee_name", employeeName);
    url.searchParams.set("attendance_type", attendanceType);
    url.searchParams.set("location_link", mapsLink); // الرابط بدل lat/lng

    const response = await fetch(url.toString(), {
      method: "GET",
      cache: "no-store",
      signal: controller.signal,
    });

    const text = (await response.text()).trim();

    if (response.ok && text.includes("Attendance recorded successfully")) {
      setMessage("Attendance recorded successfully.", "success");
    } else if (text.includes("Missing required data")) {
      setMessage("Missing required data.", "error");
    } else {
      setMessage(text || "Unexpected response from server.", "error");
    }
  } catch (error) {
    if (error.name === "AbortError") {
      setMessage("Request timed out. Please try again.", "error");
    } else {
      setMessage("Network error. Please retry.", "error");
    }
  } finally {
    window.clearTimeout(timeoutId);
  }
}
